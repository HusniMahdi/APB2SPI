###########################################################################
########################## Vivado Commands ################################
###########################################################################
###########################################################################


XVLOG				= /tools/Xilinx/Vivado/2021.2/bin/xvlog
XELAB				= /tools/Xilinx/Vivado/2021.2/bin/xelab
XSIM				= /tools/Xilinx/Vivado/2021.2/bin/xsim
PROJECT_HOME = /home/husni/Projects/APB2SPI

###########################################################################
########################## File Compilation ###############################
###########################################################################
###########################################################################
	
COMPILE_ORDER		= \
						$(PROJECT_HOME)/Parameters/test_param_pkg.sv \
						$(PROJECT_HOME)/tb/defines/def.sv \
						$(PROJECT_HOME)/rtl/timescale.v \
						$(PROJECT_HOME)/rtl/spi_defines.v \
						$(PROJECT_HOME)/rtl/spi_clgen.v \
						$(PROJECT_HOME)/rtl/spi_shift.v \
						$(PROJECT_HOME)/rtl/spi_top.v \
						$(PROJECT_HOME)/tb/tb_top/apb_interface.sv \
						$(PROJECT_HOME)/tb/tb_top/spi_interface.sv \
						$(PROJECT_HOME)/tb/agent/apb_slave/apb_agent_pkg.sv \
						$(PROJECT_HOME)/tb/agent/apb_slave/apb_driver_bfm.sv \
						$(PROJECT_HOME)/tb/agent/spi_master/spi_agent_pkg.sv \
						$(PROJECT_HOME)/tb/agent/spi_master/spi_driver_bfm.sv \
						$(PROJECT_HOME)/tb/sequence_lib/apb_sequences/apb_seq_pkg.sv \
						$(PROJECT_HOME)/tb/sequence_lib/spi_sequences/spi_seq_pkg.sv \
						$(PROJECT_HOME)/tb/sequence_lib/vseq_pkg.sv \
						$(PROJECT_HOME)/tb/env/apb2spi_env_pkg.sv \
						$(PROJECT_HOME)/tb/test_lib/apb2spi_test_pkg.sv \
						$(PROJECT_HOME)/tb/tb_top/tb_top.sv  \


###########################################################################
########################## Simulation Vars ################################
###########################################################################
###########################################################################

TB_TOP										= tb_top
COMP_OPT									= --incr --relax
SIM_LOG										= -log simulate.log
ELAB_LOG									= -log elaborate.log
XVLOG_LOG           			= -log xvlog.log
UVM 											= -L uvm		
UVM_VERBOSITY_CONTROL 		= UVM_NONE
TEST_NAME									= apb2spi_transfer_test 
TIMESCALE									= -timescale 1ns/1ps

###########################################################################
########################### Make Targets ##################################
###########################################################################
###########################################################################

compilation	: 
			$(XVLOG) -sv $(COMPILE_ORDER) $(COMP_OPT) $(UVM)

elaboration	: compilation
			$(XELAB) $(TB_TOP) --relax -s top --debug typical 
	
simulate	: clean elaboration
			$(XSIM) top -testplusarg UVM_TESTNAME=$(TEST_NAME) -testplusarg UVM_VERBOSITY=$(UVM_VERBOSITY_CONTROL) -runall
	
gen_cov_report : simulate
			xcrg -report_format html -dir $(PROJECT_HOME)/sim/xsim.covdb/top

###########################################################################
######################### WAVES ARE CHECKED FROM GTKWAVE ##################
######################### USING TB_TOP GENERATED DUMPFILE #################
###########################################################################

clean: 
	@echo "---------------------------------Running Clean--------------------------------" 
	@rm -rf *.jou *.log *.pb *.wdb xsim.dir xsim.covdb xcrg_report *.vcd 				# This deletes all files generated by Vivado
	@rm -rf .*.timestamp  										# This deletes all our timestamps




# .PHONY		: clean
# .PHONY		: wave